<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL Chatbot</title>
    
    <!-- AG Grid CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/styles/ag-grid.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/styles/ag-theme-alpine.min.css">
    
    <!-- Application CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>SQL Chatbot POC</h1>
    
    <!-- NEW: Mode Selector -->
    <div class="mode-selector">
        <button id="auto-mode-btn" class="mode-button active" data-mode="auto">
            ü§ñ Auto Mode
        </button>
        <button id="manual-mode-btn" class="mode-button" data-mode="manual">
            ‚úçÔ∏è Manual Mode
        </button>
    </div>
    
    <!-- Auto Mode: Question Input -->
    <div id="question-container" class="input-container">
        <textarea id="question-input" placeholder="Enter your question here..."></textarea>
        <button id="submit-btn" class="primary-button">Generate SQL</button>
    </div>
    
    <!-- SQL Editor Section -->
    <div class="sql-editor-section">
        <div class="sql-editor-header">
            <h2>SQL Query:</h2>
            <div class="sql-editor-controls">
                <button id="format-sql-btn" class="small-button" title="Format SQL">Format</button>
                <button id="clear-sql-btn" class="small-button" title="Clear SQL">Clear</button>
            </div>
        </div>
        <textarea id="sql-query-editor" class="sql-editor" placeholder="Write your SQL query here or generate one above..."></textarea>
        <div id="sql-validation-feedback" class="validation-feedback"></div>
        <div class="execution-controls">
            <button id="execute-sql-btn" class="primary-button" disabled>Execute SQL</button>
            <button id="regenerate-btn" class="secondary-button" style="display: none;">Regenerate</button>
        </div>
    </div>
    
    <!-- Query Metadata Bar -->
    <div id="query-metadata-bar" class="metadata-bar" style="display: none;">
        <span id="metadata-mode" class="metadata-item"></span>
        <span id="metadata-question" class="metadata-item"></span>
        <span id="metadata-timestamp" class="metadata-item"></span>
        <span id="metadata-rowcount" class="metadata-item"></span>
    </div>
    
    <hr>

    <!-- NEW: Tab Navigation -->
    <div class="tab-container">
        <button class="tab-button active" data-tab="results" id="results-tab-btn">
            Results
        </button>
        <button class="tab-button" data-tab="analysis" id="analysis-tab-btn">
            Analysis
        </button>
        <button class="tab-button" data-tab="visualizations" id="visualizations-tab-btn">
            Visualizations
        </button>
    </div>

    <!-- NEW: Results Tab Content with AG Grid -->
    <div id="results-tab" class="tab-content active">
        <div class="results-header">
            <h2>Results: <span id="results-row-count">0 rows</span></h2>
            <div class="results-toolbar">
                <button id="copy-selected-btn" class="toolbar-btn" title="Copy selected rows">
                    üìã Copy
                </button>
                <button id="export-csv-btn" class="toolbar-btn" title="Export to CSV">
                    üì• Export CSV
                </button>
                <button id="clear-filters-btn" class="toolbar-btn" title="Clear all filters" style="display: none;">
                    üîç Clear Filters
                </button>
            </div>
        </div>
        
        <!-- AG Grid Container -->
        <div id="results-grid" class="ag-theme-alpine" style="height: 600px; width: 100%;"></div>
        
        <!-- Status Bar -->
        <div id="results-status-bar" class="status-bar">
            <span id="status-rows">Rows 0-0 of 0</span>
            <span id="status-filters" style="display: none;">üîç Filters active</span>
            <span id="status-sort" style="display: none;">‚ÜïÔ∏è Sorted</span>
        </div>
        
        <!-- Loading State -->
        <div id="results-loading" class="loading-state" style="display: none;">
            <div class="spinner"></div>
            <p>Loading data grid...</p>
        </div>
        
        <!-- Empty State -->
        <div id="results-empty" class="empty-state" style="display: none;">
            <div class="empty-icon">üìä</div>
            <h3>No Results</h3>
            <p>Query returned no data.</p>
        </div>
        
        <!-- Error State -->
        <div id="results-error" class="error-state" style="display: none;">
            <div class="error-icon">‚ö†Ô∏è</div>
            <h3>Error Loading Data</h3>
            <p id="error-message">Unable to render table.</p>
            <button id="retry-grid-btn" class="retry-btn">Retry</button>
        </div>
    </div>

    <!-- NEW: Analysis Tab Content -->
    <div id="analysis-tab" class="tab-content">
        <h2>Statistical Analysis:</h2>
        <div id="analysis-loading" class="loading-indicator">
            <span class="spinner"></span> Generating analysis...
        </div>
        <div id="analysis-output"></div>
        <div id="analysis-error" class="error-message" style="display: none;"></div>
    </div>

    <!-- NEW: Visualizations Tab Content -->
    <div id="visualizations-tab" class="tab-content">
        <h2>Interactive Visualizations:</h2>
        
        <!-- Unavailable message (shown when dataset not suitable) -->
        <div id="viz-unavailable" class="viz-unavailable" style="display: none;">
            <p>Visualizations are not available for this dataset.</p>
            <p class="reason"></p>
        </div>
        
        <!-- Chart type selector (initial state) -->
        <div id="chart-type-selector" class="chart-type-selector">
            <button class="chart-type-button" data-chart="scatter" aria-label="Create scatter plot visualization">
                <span class="icon">üìä</span>
                <span class="label">Scatter Plot</span>
            </button>
            <button class="chart-type-button" data-chart="bar" aria-label="Create bar chart visualization">
                <span class="icon">üì∂</span>
                <span class="label">Bar Chart</span>
            </button>
            <button class="chart-type-button" data-chart="line" aria-label="Create line chart visualization">
                <span class="icon">üìà</span>
                <span class="label">Line Chart</span>
            </button>
            <button class="chart-type-button" data-chart="histogram" aria-label="Create histogram visualization">
                <span class="icon">üìú</span>
                <span class="label">Histogram</span>
            </button>
        </div>
        
        <!-- Configuration state: Axis selectors -->
        <div id="axis-config" class="axis-config" style="display: none;">
            <div class="chart-type-dropdown">
                <label for="chart-type-select">Chart Type:</label>
                <select id="chart-type-select" class="chart-selector" aria-label="Select chart type">
                    <option value="scatter">Scatter Plot</option>
                    <option value="bar">Bar Chart</option>
                    <option value="line">Line Chart</option>
                    <option value="histogram">Histogram</option>
                </select>
            </div>
            
            <div class="axis-selector-wrapper">
                <label for="x-axis-select" class="axis-selector-label">
                    <span id="x-axis-label">X-Axis:</span>
                </label>
                <select id="x-axis-select" class="axis-selector" aria-label="Select column for X-axis">
                    <option value="">Select Column</option>
                </select>
            </div>
            
            <div class="axis-selector-wrapper" id="y-axis-wrapper">
                <label for="y-axis-select" class="axis-selector-label">
                    <span id="y-axis-label">Y-Axis:</span>
                </label>
                <select id="y-axis-select" class="axis-selector" aria-label="Select column for Y-axis">
                    <option value="">Select Column</option>
                </select>
            </div>
        </div>
        
        <!-- Loading state -->
        <div id="chart-loading" class="skeleton-chart" style="display: none;">
            <div class="skeleton-bar"></div>
            <div class="skeleton-bar"></div>
            <div class="skeleton-bar"></div>
            <div class="skeleton-bar"></div>
            <div class="skeleton-bar"></div>
            <p class="loading-text">Generating chart...</p>
        </div>
        
        <!-- Chart container -->
        <div id="chart-container" class="chart-container" role="img" aria-label="Visualization chart"></div>
        
        <!-- Sampling notice -->
        <div id="sampling-notice" class="sampling-notice" role="status" aria-live="polite" style="display: none;"></div>
        
        <!-- Error display -->
        <div id="chart-error" class="chart-error" role="alert" aria-live="assertive" style="display: none;"></div>
    </div>

    <!-- AG Grid JS (must load before app.js) -->
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community@31.0.0/dist/ag-grid-community.min.js"></script>
    
    <!-- Application JS -->
    <script src="app.js"></script>
</body>
</html>
